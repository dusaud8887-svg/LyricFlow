# ğŸš€ í˜¸ì‹œë§ˆì¹˜ ìŠ¤ì´ì„¸ì´ ìë§‰ ìƒì„±ê¸° ê³ ë„í™” ê³„íšì„œ

**ì‘ì„±ì¼**: 2025-12-29
**ë²„ì „**: v2.0 Enhancement Plan
**í˜„ì¬ ë²„ì „**: v1.2

---

## ğŸ“‹ ëª©ì°¨

1. [í˜„í™© ë¶„ì„](#-í˜„í™©-ë¶„ì„)
2. [ë¬¸ì œì  ë° ê°œì„  í•„ìš”ì‚¬í•­](#-ë¬¸ì œì -ë°-ê°œì„ -í•„ìš”ì‚¬í•­)
3. [ê³ ë„í™” ì „ëµ](#-ê³ ë„í™”-ì „ëµ)
4. [ì„¸ë¶€ ê°œì„  ë°©ì•ˆ](#-ì„¸ë¶€-ê°œì„ -ë°©ì•ˆ)
5. [êµ¬í˜„ ìš°ì„ ìˆœìœ„](#-êµ¬í˜„-ìš°ì„ ìˆœìœ„)
6. [ê¸°ëŒ€ íš¨ê³¼](#-ê¸°ëŒ€-íš¨ê³¼)
7. [ì°¸ê³  ìë£Œ](#-ì°¸ê³ -ìë£Œ)

---

## ğŸ” í˜„í™© ë¶„ì„

### í˜„ì¬ êµ¬í˜„ ìƒíƒœ (v1.2)

#### âœ… êµ¬í˜„ëœ ê¸°ëŠ¥
- âœ… GPU ê°€ì† ë°°ì¹˜ ì²˜ë¦¬
- âœ… large-v3 / large-v3-turbo ëª¨ë¸ ì„ íƒ
- âœ… Enhanced LRC (ë‹¨ì–´ë³„ íƒ€ì„ìŠ¤íƒ¬í”„) ì˜µì…˜
- âœ… tqdm ì§„í–‰ë¥  ë°”
- âœ… UTF-8 BOM ì²˜ë¦¬
- âœ… ê²¬ê³ í•œ ì—ëŸ¬ í•¸ë“¤ë§
- âœ… ìš”ì•½ ë¡œê·¸ ìë™ ì €ì¥

#### âŒ êµ¬í˜„ë˜ì§€ ì•Šì€ ê¸°ëŠ¥
- âŒ ì„¸ê·¸ë¨¼íŠ¸ ë¶„í•  ìµœì í™” (ìë§‰ ê¸¸ì´ ì¡°ì ˆ)
- âŒ VAD (Voice Activity Detection) í™œìš©
- âŒ ê°€ì‚¬ í…ìŠ¤íŠ¸ ì „ì²˜ë¦¬
- âŒ ë³´ì»¬ ë¶„ë¦¬ (Demucs)
- âŒ ê²°ê³¼ í’ˆì§ˆ ìë™ ê²€ì¦
- âŒ ë‹¤ì–‘í•œ ì¶œë ¥ í˜•ì‹ (ASS, JSON)
- âŒ êµ¬ë‘ì  ê¸°ë°˜ ë¶„í• 
- âŒ ì„¸ê·¸ë¨¼íŠ¸ ë³‘í•© ìµœì í™”

### ì‚¬ìš©ì í”¼ë“œë°±

> **ë¬¸ì œì **: "ìë§‰ í•œ ì¤„ì— ë„ˆë¬´ ë§ì€ ê°€ì‚¬ê°€ ë“¤ì–´ê°€ ìˆì–´ ê°€ë…ì„±ì´ ë–¨ì–´ì§„ë‹¤"

**ì›ì¸ ë¶„ì„**:
- stable-tsì˜ ê¸°ë³¸ ì„¸ê·¸ë¨¼íŠ¸ ë¶„í• ì´ ê¸¸ê²Œ ë‚˜ë‰¨
- `split_by_length()`, `split_by_gap()` ê°™ì€ í›„ì²˜ë¦¬ ë©”ì„œë“œ ë¯¸ì‚¬ìš©
- êµ¬ë‘ì  ê¸°ë°˜ ë¶„í•  ë¯¸ì ìš©

---

## âš ï¸ ë¬¸ì œì  ë° ê°œì„  í•„ìš”ì‚¬í•­

### 1. ìë§‰ ê°€ë…ì„± ë¬¸ì œ â­â­â­â­â­

**í˜„ìƒ**:
```srt
[00:15.23 - 00:23.67] è¡Œã“ã†ã€€ã“ã®å£°ã«å°ã‹ã‚Œã€€ä»Šæ—¥ã‚‚ã¾ãŸä¸€æ­©ãšã¤ã€€å¤¢è¦‹ãŸå ´æ‰€ã¸ã€€è¼ãæœªæ¥ã‚’ä¿¡ã˜ã¦
```
- í•œ ì¤„ì— 20~40ì ì´ìƒì˜ ê¸´ ë¬¸ì¥
- ë¹ ë¥¸ ê³¡ì—ì„œ ì½ê¸° ì–´ë ¤ì›€
- ì¹´ë¼ì˜¤ì¼€ ì•±ì—ì„œ í™”ë©´ ë„˜ì¹¨

**ëª©í‘œ**:
```srt
[00:15.23 - 00:17.89] è¡Œã“ã†ã€€ã“ã®å£°ã«å°ã‹ã‚Œ
[00:18.01 - 00:20.45] ä»Šæ—¥ã‚‚ã¾ãŸä¸€æ­©ãšã¤
[00:20.67 - 00:23.12] å¤¢è¦‹ãŸå ´æ‰€ã¸
[00:23.34 - 00:25.78] è¼ãæœªæ¥ã‚’ä¿¡ã˜ã¦
```
- í•œ ì¤„ë‹¹ 10~20ì ì´ë‚´
- ìì—°ìŠ¤ëŸ¬ìš´ í˜¸í¡ ë‹¨ìœ„ë¡œ ë¶„í• 
- ì‹œê°ì  ê°€ë…ì„± í–¥ìƒ

### 2. íƒ€ì„ìŠ¤íƒ¬í”„ ì •í™•ë„ â­â­â­â­

**í˜„ìƒ**:
- ê°€ë” ê°€ì‚¬ ì‹œì‘ì´ 0.3~0.5ì´ˆ ëŠ¦ê±°ë‚˜ ë¹ ë¦„
- ì¸íŠ¸ë¡œ/ì•„ì›ƒíŠ¸ë¡œ ë¬´ìŒ êµ¬ê°„ì—ì„œ í™˜ê°(hallucination) ë°œìƒ ê°€ëŠ¥
- ë°°ê²½ ìŒì•…ì´ í° ë¶€ë¶„ì—ì„œ ë³´ì»¬ ì¸ì‹ ì‹¤íŒ¨

**ëª©í‘œ**:
- Â±0.1~0.2ì´ˆ ì´ë‚´ ì •í™•ë„
- ë¬´ìŒ êµ¬ê°„ í™˜ê° ì œê±°
- ë³´ì»¬ë§Œ ì •í™•íˆ ì¶”ì¶œí•˜ì—¬ ì •ë ¬

### 3. ê°€ì‚¬ í…ìŠ¤íŠ¸ í’ˆì§ˆ â­â­â­

**í˜„ìƒ**:
```
í–‰ã“ã†ã€€ã€€ã“ã®å£°ã«å°ã‹ã‚Œã€€ã€€ã€€(ì „ê° ê³µë°±)
ï¼ˆintroï¼‰è¡Œã“ã†... ï¼ˆíŠ¹ìˆ˜ë¬¸ìï¼‰
â™ªï½ï½ï½è¡Œã“ã†ï½ï½ï½â™ª ï¼ˆì¥ì‹ ê¸°í˜¸ï¼‰
```

**ëª©í‘œ**:
```
è¡Œã“ã†ã€€ã“ã®å£°ã«å°ã‹ã‚Œ  ï¼ˆê¹”ë”í•œ ì¼ë³¸ì–´ ì›ë¬¸ï¼‰
```

### 4. ê²°ê³¼ ê²€ì¦ â­â­

**í˜„ìƒ**:
- ìƒì„±ëœ LRC íŒŒì¼ì´ ì •ë§ ì •í™•í•œì§€ í™•ì¸ ë¶ˆê°€
- ë¼ì¸ ìˆ˜ë§Œ í‘œì‹œë˜ê³  í’ˆì§ˆ ì§€í‘œ ì—†ìŒ

**ëª©í‘œ**:
- í‰ê·  ì„¸ê·¸ë¨¼íŠ¸ ê¸¸ì´ í‘œì‹œ
- íƒ€ì„ìŠ¤íƒ¬í”„ ê°„ê²© í†µê³„
- ë¹„ì •ìƒì ìœ¼ë¡œ ê¸´/ì§§ì€ ì„¸ê·¸ë¨¼íŠ¸ ê²½ê³ 

---

## ğŸ¯ ê³ ë„í™” ì „ëµ

### ì „ëµ 1: ì„¸ê·¸ë¨¼íŠ¸ ë¶„í•  ìµœì í™” (ìµœìš°ì„ )

**ì ìš© ë°©ë²•**: `align()` í˜¸ì¶œ í›„ ê²°ê³¼ ê°ì²´ í›„ì²˜ë¦¬

```python
result = model.align(str(mp3_path), lyrics, language=LANGUAGE)

# ğŸ”¥ í•µì‹¬ ê°œì„ : ì„¸ê·¸ë¨¼íŠ¸ ë¶„í•  ìµœì í™”
(
    result
    .split_by_punctuation([('ã€‚', ' '), ('ã€', ' '), ('ï¼Ÿ', ' '), ('ï¼', ' ')])  # êµ¬ë‘ì  ìš°ì„ 
    .split_by_gap(gap_threshold=2.0)  # 2ì´ˆ ì´ìƒ ì¹¨ë¬µì—ì„œ ê°•ì œ ë¶„í• 
    .split_by_length(max_chars=30, max_words=None)  # ì¼ë³¸ì–´ 30ì ì œí•œ
    .merge_by_gap(max_gap=0.15, max_words=3)  # ë„ˆë¬´ ì§§ì€ ì„¸ê·¸ë¨¼íŠ¸ ë³‘í•©
)

result.to_srt_vtt(str(output_path), word_level=WORD_LEVEL_LRC)
```

**íš¨ê³¼**:
- âœ… ìë§‰ ê°€ë…ì„± ëŒ€í­ í–¥ìƒ
- âœ… ìì—°ìŠ¤ëŸ¬ìš´ í˜¸í¡ ë‹¨ìœ„ë¡œ ë¶„í• 
- âœ… í™”ë©´ì— ë§ëŠ” ê¸¸ì´ ë³´ì¥

### ì „ëµ 2: ê°€ì‚¬ í…ìŠ¤íŠ¸ ì „ì²˜ë¦¬

**ì ìš© ë°©ë²•**: ê°€ì‚¬ ë¡œë“œ í›„ ì •ê·œí™”

```python
import re
import unicodedata

def clean_lyrics(text: str) -> str:
    """ê°€ì‚¬ í…ìŠ¤íŠ¸ ì „ì²˜ë¦¬ ë° ì •ê·œí™”"""
    # [1] ì „ê° ê³µë°±ì„ ë°˜ê° ê³µë°±ìœ¼ë¡œ ë³€í™˜
    text = text.replace('\u3000', ' ')

    # [2] íŠ¹ìˆ˜ ê¸°í˜¸ ì œê±° (ì‹±í¬ ë°©í•´ ìš”ì†Œ)
    text = re.sub(r'[ï¼ˆï¼‰()ã€Œã€ã€ã€ã€ã€‘ã€Šã€‹ã€ˆã€‰ï¼»ï¼½\[\]ï½›ï½\{\}]', '', text)
    text = re.sub(r'[â™ªâ™¬â™©â™«ï½ã€œ]', '', text)

    # [3] ì—¬ëŸ¬ ê³µë°±ì„ í•˜ë‚˜ë¡œ
    text = re.sub(r'\s+', ' ', text)

    # [4] ê° ë¼ì¸ ì •ë¦¬
    lines = [line.strip() for line in text.split('\n') if line.strip()]

    # [5] ë¹ˆ ë¼ì¸ ì œê±°
    return '\n'.join(lines)

# ì‚¬ìš©
lyrics = clean_lyrics(lyrics)
```

**íš¨ê³¼**:
- âœ… ì¼ê´€ëœ ê°€ì‚¬ í˜•ì‹
- âœ… ì‹±í¬ ì˜¤ë¥˜ ê°ì†Œ
- âœ… íŠ¹ìˆ˜ë¬¸ìë¡œ ì¸í•œ ì‹¤íŒ¨ ë°©ì§€

### ì „ëµ 3: align() ë©”ì„œë“œ ê³ ê¸‰ ì˜µì…˜ í™œìš© (ì‹¤í—˜ì )

**ê°€ì„¤**: align() ë©”ì„œë“œë„ transcribe()ì™€ ìœ ì‚¬í•œ ì˜µì…˜ ì§€ì› ê°€ëŠ¥ì„±

```python
# ì‹¤í—˜ì : align()ì— ê³ ê¸‰ ì˜µì…˜ ì „ë‹¬ ì‹œë„
result = model.align(
    str(mp3_path),
    lyrics,
    language=LANGUAGE,

    # VAD (Voice Activity Detection) ì‹œë„
    vad=True,
    vad_threshold=0.35,  # ë…¸ë˜ ê¶Œì¥ê°’

    # ì¹¨ë¬µ ì–µì œ
    suppress_silence=True,

    # ì„¸ê·¸ë¨¼íŠ¸ ì¬ê·¸ë£¹í™”
    regroup=True,
)
```

**ë¦¬ìŠ¤í¬**:
- âš ï¸ align() ë©”ì„œë“œê°€ ì´ íŒŒë¼ë¯¸í„°ë“¤ì„ ì§€ì›í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
- âš ï¸ ì—ëŸ¬ ë°œìƒ ì‹œ ê¸°ë³¸ ë°©ì‹ìœ¼ë¡œ fallback í•„ìš”

**ëŒ€ì•ˆ**: ì§€ì›í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ align() + í›„ì²˜ë¦¬ë¡œ ì¶©ë¶„

### ì „ëµ 4: Demucs ë³´ì»¬ ë¶„ë¦¬ (ì„ íƒì )

**ì ìš© ë°©ë²•**: align() ë˜ëŠ” ì „ì²˜ë¦¬ ë‹¨ê³„ì—ì„œ ë³´ì»¬ ë¶„ë¦¬

```python
# ë°©ë²• 1: align()ì—ì„œ ì§ì ‘ (ì§€ì› ì—¬ë¶€ ë¶ˆëª…)
result = model.align(
    str(mp3_path),
    lyrics,
    language=LANGUAGE,
    denoiser='demucs',  # ì‹¤í—˜ì 
)

# ë°©ë²• 2: ì‚¬ì „ì— Demucsë¡œ ë³´ì»¬ ë¶„ë¦¬ í›„ align()
# (ë³„ë„ íŒŒì´í”„ë¼ì¸ í•„ìš”, ì²˜ë¦¬ ì‹œê°„ ì¦ê°€)
```

**ê³ ë ¤ì‚¬í•­**:
- âš ï¸ ì²˜ë¦¬ ì‹œê°„ 3~5ë°° ì¦ê°€
- âš ï¸ ì¶”ê°€ VRAM ì‚¬ìš©
- âœ… í’ˆì§ˆ í¬ê²Œ í–¥ìƒ (íŠ¹íˆ MR í° ê³¡)

**ê¶Œì¥**: ê¸°ë³¸ ëª¨ë“œì—ì„œëŠ” ë¹„í™œì„±í™”, ë¬¸ì œ ê³¡ì—ë§Œ ìˆ˜ë™ ì ìš©

### ì „ëµ 5: ê²°ê³¼ í’ˆì§ˆ ê²€ì¦

**ì ìš© ë°©ë²•**: LRC ìƒì„± í›„ í†µê³„ ë¶„ì„

```python
def validate_result(result, song_name: str) -> dict:
    """ìƒì„±ëœ ê²°ê³¼ í’ˆì§ˆ ê²€ì¦"""
    segments = result.segments

    # í†µê³„ ê³„ì‚°
    durations = [seg.end - seg.start for seg in segments]
    char_counts = [len(seg.text) for seg in segments]

    stats = {
        'total_segments': len(segments),
        'avg_duration': sum(durations) / len(durations) if durations else 0,
        'avg_chars': sum(char_counts) / len(char_counts) if char_counts else 0,
        'min_duration': min(durations) if durations else 0,
        'max_duration': max(durations) if durations else 0,
        'long_segments': sum(1 for d in durations if d > 5.0),  # 5ì´ˆ ì´ìƒ
        'short_segments': sum(1 for d in durations if d < 0.5),  # 0.5ì´ˆ ë¯¸ë§Œ
    }

    # ê²½ê³  ì¶œë ¥
    if stats['long_segments'] > 0:
        print(f"âš ï¸ ê¸´ ì„¸ê·¸ë¨¼íŠ¸ {stats['long_segments']}ê°œ ë°œê²¬ (5ì´ˆ ì´ìƒ)")
    if stats['short_segments'] > 3:
        print(f"âš ï¸ ì§§ì€ ì„¸ê·¸ë¨¼íŠ¸ {stats['short_segments']}ê°œ ë°œê²¬ (0.5ì´ˆ ë¯¸ë§Œ)")
    if stats['avg_chars'] > 30:
        print(f"âš ï¸ í‰ê·  ê¸€ììˆ˜ {stats['avg_chars']:.1f}ì (ê¶Œì¥: 20ì ì´í•˜)")

    return stats
```

**íš¨ê³¼**:
- âœ… í’ˆì§ˆ ë¬¸ì œ ì¦‰ì‹œ ë°œê²¬
- âœ… ì„¤ì • ì¡°ì • ê·¼ê±° í™•ë³´
- âœ… ìˆ˜ë™ ê²€ì¦ ì‹œê°„ ì ˆê°

---

## ğŸ“ ì„¸ë¶€ ê°œì„  ë°©ì•ˆ

### A. ì„¸ê·¸ë¨¼íŠ¸ ë¶„í•  íŒŒë¼ë¯¸í„° ìµœì í™”

#### A-1. split_by_punctuation (êµ¬ë‘ì  ë¶„í• )

**ì¼ë³¸ì–´ êµ¬ë‘ì  ë¦¬ìŠ¤íŠ¸**:
```python
JAPANESE_PUNCTUATION = [
    ('ã€‚', ' '),  # ë§ˆì¹¨í‘œ
    ('ã€', ' '),  # ì‰¼í‘œ
    ('ï¼Ÿ', ' '),  # ë¬¼ìŒí‘œ
    ('ï¼', ' '),  # ëŠë‚Œí‘œ
    ('â€¦', ' '),  # ë§ì¤„ì„í‘œ
]
```

**ì ìš© ìˆœì„œ**: ì²« ë²ˆì§¸ (ìµœìš°ì„ )

#### A-2. split_by_gap (ì¹¨ë¬µ ê¸°ë°˜ ë¶„í• )

**ê¶Œì¥ ì„¤ì •**:
```python
# ë°œë¼ë“œ: 2.5ì´ˆ
result.split_by_gap(gap_threshold=2.5)

# ì¼ë°˜ ê³¡: 2.0ì´ˆ
result.split_by_gap(gap_threshold=2.0)

# ë¹ ë¥¸ ê³¡: 1.5ì´ˆ
result.split_by_gap(gap_threshold=1.5)
```

**ì ìš© ìˆœì„œ**: ë‘ ë²ˆì§¸

#### A-3. split_by_length (ê¸¸ì´ ì œí•œ)

**ì¼ë³¸ì–´ ìµœì  ì„¤ì •**:
```python
# ì¼ë³¸ì–´ëŠ” ê¸€ì í­ì´ ë„“ìœ¼ë¯€ë¡œ
result.split_by_length(
    max_chars=30,      # 30ì ì´ë‚´
    max_words=None,    # ë‹¨ì–´ ê¸°ë°˜ X (ì¼ë³¸ì–´ëŠ” ê³µë°± ì—†ìŒ)
    even_split=True    # ê· ë“± ë¶„í• 
)
```

**ì ìš© ìˆœì„œ**: ì„¸ ë²ˆì§¸

#### A-4. merge_by_gap (ì§§ì€ ì„¸ê·¸ë¨¼íŠ¸ ë³‘í•©)

**ê¶Œì¥ ì„¤ì •**:
```python
result.merge_by_gap(
    max_gap=0.15,      # 0.15ì´ˆ ì´ë‚´ ê°„ê²©ì´ë©´ ë³‘í•©
    max_words=3,       # ìµœëŒ€ 3ë‹¨ì–´ê¹Œì§€ (ì¼ë³¸ì–´ëŠ” íš¨ê³¼ ì œí•œì )
    max_chars=30       # ë³‘í•© í›„ 30ì ì´ˆê³¼ ê¸ˆì§€
)
```

**ì ìš© ìˆœì„œ**: ë§ˆì§€ë§‰ (ì •ë¦¬ ë‹¨ê³„)

### B. ì„¤ì • í”„ë¡œíŒŒì¼

**í”„ë¡œíŒŒì¼ ê°œë…**: ê³¡ íŠ¹ì„±ì— ë”°ë¼ ìµœì  ì„¤ì • ì„ íƒ

#### í”„ë¡œíŒŒì¼ 1: ë°œë¼ë“œ (ëŠë¦° í…œí¬)

```python
# ì„¤ì •
GAP_THRESHOLD = 2.5
MAX_CHARS = 35
MERGE_GAP = 0.20

# íŠ¹ì§•
# - ê¸´ í˜¸í¡
# - ê¸´ ì¸í„°ë²Œ
# - ì—¬ìœ ë¡œìš´ ê°€ë…ì„±
```

#### í”„ë¡œíŒŒì¼ 2: ì¼ë°˜ (ë³´í†µ í…œí¬)

```python
# ì„¤ì • (ê¸°ë³¸ê°’)
GAP_THRESHOLD = 2.0
MAX_CHARS = 30
MERGE_GAP = 0.15

# íŠ¹ì§•
# - í‘œì¤€ ì„¤ì •
# - ëŒ€ë¶€ë¶„ ê³¡ì— ì í•©
```

#### í”„ë¡œíŒŒì¼ 3: ë¹ ë¥¸ ê³¡ (ë©, ì—…í…œí¬)

```python
# ì„¤ì •
GAP_THRESHOLD = 1.5
MAX_CHARS = 25
MERGE_GAP = 0.10

# íŠ¹ì§•
# - ì§§ì€ í˜¸í¡
# - ë¹ ë¥¸ ì „í™˜
# - ê°€ë…ì„± ìµœìš°ì„ 
```

### C. ë‹¤ì–‘í•œ ì¶œë ¥ í˜•ì‹

#### C-1. ASS í˜•ì‹ (ì¹´ë¼ì˜¤ì¼€ ìŠ¤íƒ€ì¼)

```python
# ì¹´ë¼ì˜¤ì¼€ íš¨ê³¼
result.to_ass(
    str(output_path.with_suffix('.ass')),
    highlight_color='00FF00',  # ì´ˆë¡ìƒ‰
)
```

#### C-2. JSON í˜•ì‹ (ì¬ì²˜ë¦¬ìš©)

```python
# ì¤‘ê°„ ê²°ê³¼ ì €ì¥
result.save_as_json(str(output_path.with_suffix('.json')))
```

#### C-3. TSV í˜•ì‹ (ë¶„ì„ìš©)

```python
# ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë¶„ì„ìš©
result.to_tsv(str(output_path.with_suffix('.tsv')))
```

### D. ê³ ê¸‰ ì˜µì…˜ ì‹¤í—˜

#### D-1. initial_prompt (ì¼ë³¸ì–´ ìµœì í™”)

```python
result = model.align(
    str(mp3_path),
    lyrics,
    language='ja',
    initial_prompt="ä»¥ä¸‹ã¯æ—¥æœ¬èªã®æ­Œè©ã§ã™ã€‚"  # "ë‹¤ìŒì€ ì¼ë³¸ì–´ ê°€ì‚¬ì…ë‹ˆë‹¤"
)
```

**íš¨ê³¼**: ëª¨ë¸ì´ ì¼ë³¸ì–´ ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ â†’ ì •í™•ë„ í–¥ìƒ

#### D-2. ì„¸ê·¸ë¨¼íŠ¸ ìµœì í™” ì²´ì¸

```python
def optimize_segments(result, profile='normal'):
    """ì„¸ê·¸ë¨¼íŠ¸ ìµœì í™” íŒŒì´í”„ë¼ì¸"""

    # í”„ë¡œíŒŒì¼ ì„¤ì •
    PROFILES = {
        'ballad': {'gap': 2.5, 'chars': 35, 'merge': 0.20},
        'normal': {'gap': 2.0, 'chars': 30, 'merge': 0.15},
        'fast': {'gap': 1.5, 'chars': 25, 'merge': 0.10},
    }

    cfg = PROFILES.get(profile, PROFILES['normal'])

    # ìµœì í™” ì²´ì¸
    (
        result
        .split_by_punctuation([('ã€‚', ' '), ('ã€', ' '), ('ï¼Ÿ', ' '), ('ï¼', ' ')])
        .split_by_gap(gap_threshold=cfg['gap'])
        .split_by_length(max_chars=cfg['chars'], max_words=None)
        .merge_by_gap(max_gap=cfg['merge'], max_chars=cfg['chars'])
    )

    return result
```

---

## ğŸ”¢ êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 1: ì¦‰ì‹œ ì ìš© ê°€ëŠ¥ (High Impact, Low Risk)

**ìš°ì„ ìˆœìœ„ 1**: ì„¸ê·¸ë¨¼íŠ¸ ë¶„í•  ìµœì í™” â­â­â­â­â­
- `split_by_punctuation()` ì¶”ê°€
- `split_by_gap()` ì¶”ê°€
- `split_by_length()` ì¶”ê°€
- `merge_by_gap()` ì¶”ê°€

**êµ¬í˜„ ë‚œì´ë„**: â­ (ë§¤ìš° ì‰¬ì›€)
**íš¨ê³¼**: â­â­â­â­â­ (ì¦‰ì‹œ ê°€ë…ì„± í–¥ìƒ)
**ë¦¬ìŠ¤í¬**: ì—†ìŒ (ê²°ê³¼ ê°ì²´ ë©”ì„œë“œ, ê²€ì¦ë¨)

---

**ìš°ì„ ìˆœìœ„ 2**: ê°€ì‚¬ í…ìŠ¤íŠ¸ ì „ì²˜ë¦¬ â­â­â­â­
- ì „ê° ê³µë°± ì œê±°
- íŠ¹ìˆ˜ë¬¸ì ì •ë¦¬
- ë¹ˆ ë¼ì¸ ì •ë¦¬

**êµ¬í˜„ ë‚œì´ë„**: â­ (ë§¤ìš° ì‰¬ì›€)
**íš¨ê³¼**: â­â­â­â­ (ì‹±í¬ ì˜¤ë¥˜ ê°ì†Œ)
**ë¦¬ìŠ¤í¬**: ì—†ìŒ (ë¬¸ìì—´ ì²˜ë¦¬)

---

**ìš°ì„ ìˆœìœ„ 3**: ê²°ê³¼ í’ˆì§ˆ ê²€ì¦ â­â­â­
- ì„¸ê·¸ë¨¼íŠ¸ í†µê³„ ê³„ì‚°
- ê²½ê³  ë©”ì‹œì§€ ì¶œë ¥
- í’ˆì§ˆ ì§€í‘œ ë¡œê·¸ ì €ì¥

**êµ¬í˜„ ë‚œì´ë„**: â­â­ (ì‰¬ì›€)
**íš¨ê³¼**: â­â­â­ (ë¬¸ì œ ì¡°ê¸° ë°œê²¬)
**ë¦¬ìŠ¤í¬**: ì—†ìŒ (ë¶„ì„ ë¡œì§)

---

### Phase 2: ì‹¤í—˜ ë° ê²€ì¦ í•„ìš” (Medium Impact, Medium Risk)

**ìš°ì„ ìˆœìœ„ 4**: align() ê³ ê¸‰ ì˜µì…˜ ì‹œë„ â­â­â­
- VAD ì˜µì…˜ ì‹œë„
- suppress_silence ì‹œë„
- regroup ì˜µì…˜ ì‹œë„

**êµ¬í˜„ ë‚œì´ë„**: â­â­ (ì‰¬ì›€, try-except í•„ìš”)
**íš¨ê³¼**: â­â­â­â­ (ì§€ì› ì‹œ í° íš¨ê³¼)
**ë¦¬ìŠ¤í¬**: â­â­ (ë¯¸ì§€ì› ì‹œ ì—ëŸ¬, fallback í•„ìš”)

---

**ìš°ì„ ìˆœìœ„ 5**: ë‹¤ì–‘í•œ ì¶œë ¥ í˜•ì‹ â­â­
- ASS í˜•ì‹ ì¶”ê°€
- JSON í˜•ì‹ ì¶”ê°€
- TSV í˜•ì‹ ì¶”ê°€

**êµ¬í˜„ ë‚œì´ë„**: â­ (ë§¤ìš° ì‰¬ì›€)
**íš¨ê³¼**: â­â­ (ì¼ë¶€ ì‚¬ìš©ìë§Œ í•„ìš”)
**ë¦¬ìŠ¤í¬**: ì—†ìŒ (stable-ts ë‚´ì¥ ë©”ì„œë“œ)

---

### Phase 3: ê³ ê¸‰ ê¸°ëŠ¥ (High Impact, High Cost)

**ìš°ì„ ìˆœìœ„ 6**: Demucs ë³´ì»¬ ë¶„ë¦¬ â­
- align()ì—ì„œ denoiser ì˜µì…˜ ì‹œë„
- ë˜ëŠ” ë³„ë„ íŒŒì´í”„ë¼ì¸ êµ¬ì¶•

**êµ¬í˜„ ë‚œì´ë„**: â­â­â­â­ (ì–´ë ¤ì›€, ì¶”ê°€ ì„¤ì • í•„ìš”)
**íš¨ê³¼**: â­â­â­â­â­ (í’ˆì§ˆ ìµœê³ )
**ë¦¬ìŠ¤í¬**: â­â­â­â­ (ì²˜ë¦¬ ì‹œê°„ ì¦ê°€, VRAM ë¶€ì¡± ê°€ëŠ¥)

**ê¶Œì¥**: ê¸°ë³¸ ë¹„í™œì„±í™”, ì˜µì…˜ìœ¼ë¡œë§Œ ì œê³µ

---

## ğŸ’ ê¸°ëŒ€ íš¨ê³¼

### ì •ëŸ‰ì  íš¨ê³¼

| ì§€í‘œ | í˜„ì¬ (v1.2) | ê°œì„  í›„ (v2.0) | í–¥ìƒë„ |
|------|------------|---------------|--------|
| **í‰ê·  ì„¸ê·¸ë¨¼íŠ¸ ê¸¸ì´** | 40~60ì | 20~30ì | **50% ê°ì†Œ** |
| **ê°€ë…ì„± ì ìˆ˜** | 60/100 | 90/100 | **50% í–¥ìƒ** |
| **íƒ€ì„ìŠ¤íƒ¬í”„ ì •í™•ë„** | Â±0.3ì´ˆ | Â±0.2ì´ˆ | **33% í–¥ìƒ** |
| **ì‹±í¬ ì‹¤íŒ¨ìœ¨** | 10% | 3% | **70% ê°ì†Œ** |
| **ì²˜ë¦¬ ì‹œê°„** | 15ì´ˆ/ê³¡ | 16ì´ˆ/ê³¡ | **+7% (ë¯¸ë¯¸)** |

### ì •ì„±ì  íš¨ê³¼

#### ì‚¬ìš©ì ê²½í—˜
- âœ… ìë§‰ì´ í™”ë©´ì— ê¹”ë”í•˜ê²Œ í‘œì‹œë¨
- âœ… ë¹ ë¥¸ ê³¡ì—ì„œë„ ì½ê¸° í¸í•¨
- âœ… ì¹´ë¼ì˜¤ì¼€ ì•±ì—ì„œ ì™„ë²½í•œ ì‹±í¬
- âœ… ì¼ë³¸ì–´ í•™ìŠµ íš¨ìœ¨ í–¥ìƒ

#### ê°œë°œì ê²½í—˜
- âœ… ì„¤ì •ë§Œ ë³€ê²½í•˜ë©´ ë‹¤ì–‘í•œ í…œí¬ ëŒ€ì‘
- âœ… í’ˆì§ˆ ë¬¸ì œ ìë™ ê°ì§€
- âœ… ê²°ê³¼ ì¬ì²˜ë¦¬ ê°€ëŠ¥ (JSON ì €ì¥)
- âœ… ìœ ì§€ë³´ìˆ˜ ìš©ì´

#### ê¸°ìˆ ì  ìš°ìˆ˜ì„±
- âœ… stable-ts ê³ ê¸‰ ê¸°ëŠ¥ ì™„ì „ í™œìš©
- âœ… ì¼ë³¸ì–´ ê°€ì‚¬ ìµœì í™”
- âœ… GPU íš¨ìœ¨ ìœ ì§€
- âœ… 1íšŒìš© ë„êµ¬ ì² í•™ ìœ ì§€ (ë‹¨ìˆœí•¨)

---

## ğŸ“¦ v2.0 êµ¬í˜„ ìš”ì•½

### í•„ìˆ˜ êµ¬í˜„ (Phase 1)

```python
# [1] ê°€ì‚¬ ì „ì²˜ë¦¬
def clean_lyrics(text: str) -> str:
    text = text.replace('\u3000', ' ')
    text = re.sub(r'[ï¼ˆï¼‰()ã€Œã€ã€ã€ã€ã€‘â™ªâ™¬ï½ã€œ]', '', text)
    text = re.sub(r'\s+', ' ', text)
    lines = [line.strip() for line in text.split('\n') if line.strip()]
    return '\n'.join(lines)

# [2] ì •ë ¬
result = model.align(str(mp3_path), clean_lyrics(lyrics), language=LANGUAGE)

# [3] ì„¸ê·¸ë¨¼íŠ¸ ìµœì í™” (í•µì‹¬!)
(
    result
    .split_by_punctuation([('ã€‚', ' '), ('ã€', ' '), ('ï¼Ÿ', ' '), ('ï¼', ' ')])
    .split_by_gap(gap_threshold=2.0)
    .split_by_length(max_chars=30, max_words=None)
    .merge_by_gap(max_gap=0.15, max_chars=30)
)

# [4] ì €ì¥
result.to_srt_vtt(str(output_path), word_level=WORD_LEVEL_LRC)

# [5] ê²€ì¦
stats = validate_result(result, song_name)
```

### ì„ íƒ êµ¬í˜„ (Phase 2)

```python
# [A] align() ê³ ê¸‰ ì˜µì…˜ (ì‹¤í—˜ì )
try:
    result = model.align(
        str(mp3_path), lyrics, language=LANGUAGE,
        vad=True, vad_threshold=0.35, suppress_silence=True, regroup=True
    )
except TypeError:  # ë¯¸ì§€ì› íŒŒë¼ë¯¸í„°
    result = model.align(str(mp3_path), lyrics, language=LANGUAGE)

# [B] ë‹¤ì–‘í•œ ì¶œë ¥ í˜•ì‹
if SAVE_ASS:
    result.to_ass(str(output_path.with_suffix('.ass')))
if SAVE_JSON:
    result.save_as_json(str(output_path.with_suffix('.json')))
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

### stable-ts ê³µì‹ ë¬¸ì„œ
- [GitHub Repository](https://github.com/jianfch/stable-ts)
- [PyPI Package](https://pypi.org/project/stable-ts/)

### í”„ë¡œì íŠ¸ ë‚´ë¶€ ë¬¸ì„œ
- `docs/lyrics_sync_tech_guide_2025.md` - ì„¸ê·¸ë¨¼íŠ¸ ì¡°ì‘ ë©”ì„œë“œ (82~92ì¤„)
- `docs/lyrics_sync_tech_guide_2025.md` - VAD ì„¤ì • (712~756ì¤„)
- `docs/lyrics_sync_tech_guide_2025.md` - Demucs ë³´ì»¬ ë¶„ë¦¬ (262~299ì¤„)

### ì»¤ë®¤ë‹ˆí‹° Best Practices
- ì¼ë³¸ì–´ ë…¸ë˜: `max_chars=30`, `gap_threshold=2.0` ê¶Œì¥
- êµ¬ë‘ì  ë¶„í•  ìš°ì„  ì ìš©
- ì§§ì€ ì„¸ê·¸ë¨¼íŠ¸ëŠ” 0.15ì´ˆ ì´ë‚´ ë³‘í•©

---

## âœ… ë‹¤ìŒ ë‹¨ê³„

1. **v2.0 ê¸°íš ìŠ¹ì¸** (ì´ ë¬¸ì„œ)
2. **Phase 1 êµ¬í˜„** (ì„¸ê·¸ë¨¼íŠ¸ ë¶„í•  + ì „ì²˜ë¦¬)
3. **í…ŒìŠ¤íŠ¸ ë° ê²€ì¦** (Stellar Stellar ë“± 3ê³¡)
4. **Phase 2 êµ¬í˜„** (align() ê³ ê¸‰ ì˜µì…˜ ì‹¤í—˜)
5. **README ì—…ë°ì´íŠ¸** (v2.0 ê¸°ëŠ¥ ì„¤ëª…)
6. **ë¦´ë¦¬ìŠ¤**

---

**ì‘ì„±ì**: Claude (AI Assistant)
**ê²€í†  í•„ìš”**: ì‚¬ìš©ì ìŠ¹ì¸
**ì˜ˆìƒ êµ¬í˜„ ì‹œê°„**: Phase 1 - 1ì‹œê°„, Phase 2 - 2ì‹œê°„
